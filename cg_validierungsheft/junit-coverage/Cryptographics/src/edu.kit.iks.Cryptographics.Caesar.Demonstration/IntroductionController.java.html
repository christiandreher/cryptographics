<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>IntroductionController.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">test (Mar 21, 2014 6:54:09 PM)</a> &gt; <a href="../../index.html" class="el_group">Cryptographics</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.source.html" class="el_package">edu.kit.iks.Cryptographics.Caesar.Demonstration</a> &gt; <span class="el_source">IntroductionController.java</span></div><h1>IntroductionController.java</h1><pre class="source lang-java linenums"><span class="fc" id="L1">package edu.kit.iks.Cryptographics.Caesar.Demonstration;</span>

import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseEvent;
import java.io.IOException;
import java.io.InputStream;

import org.jdom2.Document;
import org.jdom2.Element;
import org.jdom2.JDOMException;
import org.jdom2.input.SAXBuilder;
import org.xnap.commons.i18n.I18n;

import edu.kit.iks.Cryptographics.VisualizationContainerController;
import edu.kit.iks.CryptographicsLib.AbstractVisualizationController;
import edu.kit.iks.CryptographicsLib.AbstractVisualizationInfo;
import edu.kit.iks.CryptographicsLib.Configuration;
import edu.kit.iks.CryptographicsLib.ImageView;
import edu.kit.iks.CryptographicsLib.Logger;
import edu.kit.iks.CryptographicsLib.MouseClickListener;

/**
 * This class is the controller of the view CFirstView.
 * 
 * @author Wasilij Beskorovajnov.
 * 
 */
public class IntroductionController extends AbstractVisualizationController {

	/**
	 * Localization instance
	 */
<span class="fc" id="L37">	private static I18n i18n = Configuration.getInstance().getI18n(</span>
<span class="fc" id="L38">			IntroductionController.class);</span>

	/**
	 * Variable holding track of the current step user has proceeded in the animation. if it is 0,
	 * then it is the last step.
	 */
	private int introductionStep;

	/**
	 * Caesar root element from the xml file.
	 */
	private Element caesarResources;

	/**
	 * Constructor.
	 * 
	 * @param visualizationInfo
	 */
	public IntroductionController(AbstractVisualizationInfo visualizationInfo) {
<span class="fc" id="L57">		super(visualizationInfo);</span>

<span class="fc" id="L59">		SAXBuilder saxBuilder = new SAXBuilder();</span>

		// obtain file object
<span class="fc" id="L62">		InputStream is = this.getClass().getResourceAsStream(</span>
<span class="fc" id="L63">				&quot;/caesar/CaesarResources.xml&quot;);</span>

		try {
			// converted file to document object
<span class="fc" id="L67">			Document document = saxBuilder.build(is);</span>

			// get root node from xml
<span class="fc" id="L70">			this.caesarResources = document.getRootElement();</span>
<span class="pc" id="L71">		} catch (JDOMException | IOException e) {</span>
<span class="nc" id="L72">			Logger.error(e);</span>
		}
<span class="fc" id="L74">	}</span>

	/**
	 * Gets the view
	 * 
	 * @return The view of this controller
	 */
	@Override
	public IntroductionView getView() {
<span class="fc" id="L83">		return (IntroductionView) this.view;</span>
	}

	@Override
	public void loadView() {
<span class="fc" id="L88">		this.introductionStep = 1;</span>
<span class="fc" id="L89">		this.view = new IntroductionView();</span>

<span class="fc" id="L91">		this.setResourceImage(&quot;CaesarIdea&quot;);</span>

<span class="fc" id="L93">		this.getView().getNextButton().addActionListener(new ActionListener() {</span>
			@Override
			public void actionPerformed(ActionEvent event) {
<span class="nc" id="L96">				VisualizationContainerController containerController = (VisualizationContainerController) IntroductionController.this</span>
<span class="nc" id="L97">						.getParentController();</span>
<span class="nc" id="L98">				containerController.presentNextVisualizationController();</span>
<span class="nc" id="L99">			}</span>
		});

<span class="fc" id="L102">		this.getView().getProceed().addMouseListener(new MouseClickListener() {</span>
			@Override
			public void clicked(MouseEvent e) {
<span class="nc" id="L105">				IntroductionController.this</span>
<span class="nc" id="L106">						.proceedIntroduction(IntroductionController.this</span>
<span class="nc" id="L107">								.getAnimationStep());</span>
<span class="nc" id="L108">			}</span>
		});

<span class="fc" id="L111">	}</span>

	// ----------------------------------------------------------//
	// --------------------private methods-----------------------//

	private void proceedIntroduction(int step) {
<span class="nc bnc" id="L117" title="All 5 branches missed.">		switch (step) {</span>
		case 1:
<span class="nc" id="L119">			this.step1();</span>
<span class="nc" id="L120">			break;</span>
		case 2:
<span class="nc" id="L122">			this.step2();</span>
<span class="nc" id="L123">			break;</span>
		case 3:
<span class="nc" id="L125">			this.step3();</span>
<span class="nc" id="L126">			break;</span>
		case 4:
<span class="nc" id="L128">			this.step4();</span>
<span class="nc" id="L129">			break;</span>
		default:
<span class="nc" id="L131">			Logger.debug(&quot;IntroductionController&quot;, &quot;proceedIntroduction&quot;,</span>
<span class="nc" id="L132">					&quot;Invalid introduction step!&quot;);</span>
		}
<span class="nc" id="L134">	}</span>

	private void setResourceImage(String resourceID) {
<span class="fc" id="L137">		String path = &quot;&quot;;</span>
		try {
<span class="fc" id="L139">			path = IntroductionController.this.getCaesarResources()</span>
<span class="fc" id="L140">					.getChild(&quot;Introduction&quot;).getChild(resourceID)</span>
<span class="fc" id="L141">					.getAttributeValue(&quot;path&quot;);</span>
<span class="pc" id="L142">		} catch (NullPointerException nullException) {</span>
			//Element not found.
<span class="nc" id="L144">			System.out.println(&quot;[NullPointerException] Ressource not found.&quot;);</span>
<span class="nc" id="L145">			nullException.printStackTrace();</span>
		}
		
<span class="fc" id="L148">		GridBagConstraints imgConstraint = new GridBagConstraints();</span>
<span class="fc" id="L149">		imgConstraint.gridx = 1;</span>
<span class="fc" id="L150">		imgConstraint.gridy = 0;</span>
<span class="fc" id="L151">		ImageView imageToSet = new ImageView(path);</span>
<span class="fc" id="L152">		this.getView().getAnimationContainer().add(imageToSet, imgConstraint);</span>
<span class="fc" id="L153">	}</span>

	private void step1() {
<span class="nc" id="L156">		this.introductionStep++;</span>
<span class="nc" id="L157">		this.getView().getAnimationContainer().removeAll();</span>
<span class="nc" id="L158">		this.getView()</span>
<span class="nc" id="L159">				.getExplanation()</span>
<span class="nc" id="L160">				.setText(</span>
<span class="nc" id="L161">						&quot;&lt;html&gt;&lt;div style=\&quot;width:600px;\&quot;&gt;&quot;</span>
<span class="nc" id="L162">								+ IntroductionController.i18n</span>
<span class="nc" id="L163">										.tr(&quot;Unfortunately his courier took the way through the forest, where Kryptolix chased &quot;</span>
<span class="nc" id="L164">												+ &quot;some wild boars.&quot;) + &quot;&lt;/div&gt;&lt;/html&gt;&quot;);</span>
        
<span class="nc" id="L166">		this.setResourceImage(&quot;Courier&quot;);</span>

<span class="nc" id="L168">		this.getView().validate();</span>
<span class="nc" id="L169">		this.getView().getAnimationContainer().repaint();</span>

<span class="nc" id="L171">	}</span>

	private void step2() {
<span class="nc" id="L174">		this.introductionStep++;</span>
<span class="nc" id="L175">		this.getView().getAnimationContainer().removeAll();</span>
<span class="nc" id="L176">		this.getView()</span>
<span class="nc" id="L177">				.getExplanation()</span>
<span class="nc" id="L178">				.setText(</span>
<span class="nc" id="L179">						&quot;&lt;html&gt;&lt;div style=\&quot;width:600px;\&quot;&gt;&quot;</span>
<span class="nc" id="L180">								+ IntroductionController.i18n</span>
<span class="nc" id="L181">										.tr(&quot;When Kryptolix noticed the unsuspecting and whistling roman courier, he punched him back to Rome as the crow flies. &quot;</span>
<span class="nc" id="L182">												+ &quot;But the courier had lost his invaluable scroll!&quot;) + &quot;&lt;/div&gt;&lt;/html&gt;&quot;);</span>
<span class="nc" id="L183">		this.setResourceImage(&quot;FlyingCourier&quot;);</span>
		

<span class="nc" id="L186">	}</span>

	private void step3() {
<span class="nc" id="L189">		this.introductionStep++;</span>
<span class="nc" id="L190">		this.getView().getAnimationContainer().removeAll();</span>
<span class="nc" id="L191">		this.getView()</span>
<span class="nc" id="L192">				.getExplanation()</span>
<span class="nc" id="L193">				.setText(</span>
<span class="nc" id="L194">						&quot;&lt;html&gt;&lt;div style=\&quot;width:700px;\&quot;&gt;&quot;</span>
<span class="nc" id="L195">								+ IntroductionController.i18n</span>
<span class="nc" id="L196">										.tr(&quot;When reading the scroll the courier lost, Kryptolix identified it as Caesar's plan to &quot;</span>
<span class="nc" id="L197">												+ &quot;conquer Gallia. Because of this, Kryptolix and his friends were able to defeat Caesar once more!&quot;) + &quot;&lt;/div&gt;&lt;/html&gt;&quot;);</span>

<span class="nc" id="L199">		this.setResourceImage(&quot;Kryptolix&quot;);</span>
		
<span class="nc" id="L201">		 this.getView().validate();</span>
<span class="nc" id="L202">		 this.getView().repaint();</span>
<span class="nc" id="L203">	}</span>

	private void step4() {
<span class="nc" id="L206">		this.getView().getAnimationContainer().removeAll();</span>
<span class="nc" id="L207">		this.getView()</span>
<span class="nc" id="L208">				.getExplanation()</span>
<span class="nc" id="L209">				.setText(</span>
<span class="nc" id="L210">						&quot;&lt;html&gt;&lt;div style=\&quot;width:700px;\&quot;&gt;&quot;</span>
<span class="nc" id="L211">								+ IntroductionController.i18n</span>
<span class="nc" id="L212">										.tr(&quot;Caesar was raging! While he was torturing some Gauls, suddenly an hellacious and foolproof idea &quot;</span>
												+ &quot;crossed his mind. In his next message he would encrypt his name! Hue Hue Hue. Help him!&quot;));
<span class="nc" id="L214">        GridBagLayout introLayout = (GridBagLayout) this.getView().getLayout();</span>
<span class="nc" id="L215">        this.getView().getNextButton().setText(IntroductionController.i18n.tr(&quot;To Caesar's idea&quot;));</span>
<span class="nc" id="L216">        GridBagConstraints finishConstraints = new GridBagConstraints();</span>
<span class="nc" id="L217">        finishConstraints.gridx = 1;</span>
<span class="nc" id="L218">        finishConstraints.gridy = 2;</span>
<span class="nc" id="L219">        finishConstraints.insets = new Insets(0, 250, 0, 0);</span>
<span class="nc" id="L220">        introLayout.setConstraints(this.getView().getNextButton(), finishConstraints);</span>
		
<span class="nc" id="L222">		this.setResourceImage(&quot;CaesarAngry&quot;);</span>
<span class="nc" id="L223">		this.getView().remove(this.getView().getProceed());</span>
<span class="nc" id="L224">		this.getView().setProceed(null);</span>
		
<span class="nc" id="L226">		this.getView().repaint();</span>
<span class="nc" id="L227">		this.getView().validate();</span>

<span class="nc" id="L229">	}</span>

	// ----------------------------------------------------------//
	// ---------------------Getter/Setter-------------------------//
	/**
	 * @return the animationStep
	 */
	public int getAnimationStep() {
<span class="nc" id="L237">		return this.introductionStep;</span>
	}

	@Override
	public String getHelp() {
<span class="nc" id="L242">		String help = IntroductionController.i18n</span>
<span class="nc" id="L243">				.tr(&quot;If you want to hear the awesome legend about Caesar &quot;</span>
						+ &quot;and Kryptolix press the button below the text. Otherwise you can skip this with the button in the top right corner!&quot;);

<span class="nc" id="L246">		return help;</span>
	}

	@Override
	public void unloadView() {
<span class="nc" id="L251">		this.view = null;</span>
<span class="nc" id="L252">	}</span>

	/**
	 * @return the caesarResources
	 */
	public Element getCaesarResources() {
<span class="fc" id="L258">		return caesarResources;</span>
	}

	/**
	 * @param caesarResources
	 *            the caesarResources to set
	 */
	public void setCaesarResources(Element caesarResources) {
<span class="nc" id="L266">		this.caesarResources = caesarResources;</span>
<span class="nc" id="L267">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.0.201403182114</span>test (Mar 21, 2014 6:54:09 PM)</div></body></html>